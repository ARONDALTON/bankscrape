#!/usr/bin/env python
import os
import sys
import logging
from optparse import OptionParser
from ConfigParser import SafeConfigParser

if __name__ == '__main__':
    parser = OptionParser(usage="%prog [options] bankname")
    parser.add_option('-f', '--config-file', dest="configfile", help="config file", default=os.path.expanduser("~/.bankscrape"))
    parser.add_option('-s', '--config-section', dest="configsection", help="config section", default='[bankname]')
    (options, args) = parser.parse_args()
    try:
        bankname = args[0]
    except IndexError:
        parser.error("You must specify and bankname")
    if options.configsection == '[bankname]':
        options.configsection = bankname
    config = SafeConfigParser()
    config.read(options.configfile)
    config_items = dict(config.items(options.configsection))

    banknames = __import__('bankscrape.banks', globals(), locals(), [bankname], -1)
    bank = getattr(banknames, bankname)
    csv = bank.scrape(config_items)
    sys.stdout.write(csv)
